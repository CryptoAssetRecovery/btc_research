# Enhanced configuration example: RSI + EMA strategy with optimization parameters
# This configuration demonstrates the new optimization framework capabilities
# including parameter specifications, validation strategies, and robustness testing

version: "1.0"
name: "Enhanced RSI + EMA with Optimization"
symbol: "BTC/USDC"
exchange: "binanceus"

# Named timeframes for this strategy
timeframes:
  trend: "1h"    # Higher timeframe for trend bias
  entry: "5m"    # Lower timeframe for entry/exit signals

# Indicators to compute
indicators:
  # EMA on 1-hour timeframe for trend bias
  - id: "EMA_200"
    type: "EMA"
    timeframe: "1h"
    length: 200

  # RSI on 5-minute timeframe for entry/exit
  - id: "RSI_14"
    type: "RSI" 
    timeframe: "5m"
    length: 14

# Trading logic expressions
logic:
  entry_long:
    - "EMA_200_trend == 'bull'"  # Trend must be bullish on 1h
    - "RSI_14 < 30"              # RSI oversold on 5m
  
  exit_long:
    - "RSI_14 > 70"              # RSI overbought - take profit
  
  # Short trading disabled for this strategy
  entry_short: []
  exit_short: []

# Backtesting parameters
backtest:
  cash: 10000          # Starting capital in USD
  commission: 0.0004   # 0.04% commission per trade
  slippage: 0.0        # No slippage assumption
  from: "2024-01-01"   # Start date
  to: "2025-01-01"     # End date

# Optimization configuration (new section)
optimization:
  # Parameter search space definitions
  parameters:
    # EMA length optimization
    - name: "EMA_200.length"
      type: "integer"
      low: 100
      high: 300
      step: 25
      description: "EMA period for trend detection"
    
    # RSI length optimization
    - name: "RSI_14.length"
      type: "integer" 
      low: 10
      high: 25
      step: 1
      description: "RSI calculation period"
    
    # RSI oversold threshold (entry)
    - name: "rsi_oversold"
      type: "float"
      low: 20.0
      high: 40.0
      step: 5.0
      description: "RSI oversold threshold for entry"
      mapping: "logic.entry_long[1]"  # Maps to RSI_14 < threshold
    
    # RSI overbought threshold (exit)
    - name: "rsi_overbought"
      type: "float"
      low: 60.0
      high: 80.0
      step: 5.0
      description: "RSI overbought threshold for exit"
      mapping: "logic.exit_long[0]"   # Maps to RSI_14 > threshold
  
  # Default optimization settings
  defaults:
    method: "bayesian"           # Optimization algorithm
    validation: "walk-forward"   # Validation strategy
    metric: "sharpe_ratio"       # Primary optimization metric
    max_iterations: 100          # Maximum optimization iterations
    
    # Validation configuration
    validation_config:
      n_splits: 5                # Number of validation folds
      test_size: 0.2            # Test set proportion
      gap: 24                   # Gap between train/test (hours)
    
    # Robustness testing
    robustness_tests:
      - type: "monte_carlo"
        simulations: 1000
        noise_level: 0.05
      - type: "bootstrap"
        n_bootstrap: 500
        confidence_level: 0.95
    
    # Statistical testing
    statistical_tests:
      - type: "hypothesis"
        alpha: 0.05
      - type: "performance"
        benchmark: "buy_and_hold"

# Extended backtesting metrics to track
metrics:
  # Core performance metrics
  - "total_return"
  - "sharpe_ratio"
  - "sortino_ratio"
  - "calmar_ratio"
  - "max_drawdown"
  - "profit_factor"
  - "win_rate"
  - "expectancy"
  
  # Risk metrics
  - "value_at_risk_95"
  - "expected_shortfall_95"
  - "downside_deviation"
  
  # Trade statistics
  - "num_trades"
  - "avg_trade_duration"
  - "avg_win"
  - "avg_loss"
  - "largest_win"
  - "largest_loss"
  
  # Stability metrics
  - "stability_ratio"
  - "consistency_score"